import asyncio
import logging
from aiogram import Bot, Dispatcher, Router, F
from aiogram.filters import CommandStart, Command
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from urllib.parse import quote

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –í–ê–ñ–õ–ò–í–û: –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤—ñ–¥ @BotFather
BOT_TOKEN = "8339845737:AAHpUNfSwmk1KOewN1KoRfsOlRYTapHJ1gM"

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–æ—Ç–∞ —Ç–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()
router = Router()

# –î–∞–Ω—ñ —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ–≤ (–∫–æ–¥–∏ –∑ QR-–ø–æ—Å–∏–ª–∞–Ω—å)
MACHINES = {
    "tre_001": {
        "video": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "desc": "–ë—ñ–≥–æ–≤–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä - —ñ–¥–µ–∞–ª—å–Ω–∏–π –¥–ª—è –∫–∞—Ä–¥—ñ–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å —Ç–∞ —Ä–æ–∑–º–∏–Ω–∫–∏. –ü–æ—á–Ω—ñ—Ç—å –∑ –ø–æ–≤—ñ–ª—å–Ω–æ–≥–æ —Ç–µ–º–ø—É —Ç–∞ –ø–æ—Å—Ç—É–ø–æ–≤–æ –∑–±—ñ–ª—å—à—É–π—Ç–µ —à–≤–∏–¥–∫—ñ—Å—Ç—å."
    },
    "tre_002": {
        "video": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "desc": "–°–∏–ª–æ–≤–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è –Ω—ñ–≥ - —Ä–æ–∑–≤–∏–≤–∞—î –º'—è–∑–∏ —Å—Ç–µ–≥–æ–Ω —Ç–∞ —Å—ñ–¥–Ω–∏—Ü—å. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤–∞–≥—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–æ–≥–æ —Ä—ñ–≤–Ω—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏."
    },
    "tre_003": {
        "video": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "desc": "–¢—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è —Å–ø–∏–Ω–∏ - –∑–º—ñ—Ü–Ω—é—î —à–∏—Ä–æ—á–∞–π—à—ñ –º'—è–∑–∏ —Å–ø–∏–Ω–∏. –¢—Ä–∏–º–∞–π—Ç–µ —Å–ø–∏–Ω—É —Ä—ñ–≤–Ω–æ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é–π—Ç–µ —Ä—É—Ö."
    },
    "tre_004": {
        "video": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "desc": "–¢—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è –≥—Ä—É–¥–µ–π - —Ä–æ–∑–≤–∏–≤–∞—î –≥—Ä—É–¥–Ω—ñ –º'—è–∑–∏ —Ç–∞ —Ç—Ä–∏—Ü–µ–ø—Å–∏. –î–∏—Ö–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∏–¥–∏—Ö –Ω–∞ –∑—É—Å–∏–ª–ª—ñ."
    },
    "tre_005": {
        "video": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "desc": "–ï–ª—ñ–ø—Ç–∏—á–Ω–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä - –º'—è–∫–µ –∫–∞—Ä–¥—ñ–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –≤—Å—å–æ–≥–æ —Ç—ñ–ª–∞. –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –ª—é–¥–µ–π –∑ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å—É–≥–ª–æ–±—ñ–≤."
    }
}

# –î–∞–Ω—ñ —Ç—Ä–µ–Ω–µ—Ä—ñ–≤ –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏
TRAINERS = {
    "andriy_tg": {
        "name": "–ê–Ω–¥—Ä—ñ–π (Telegram)",
        "url": f"https://t.me/andriy_trainer?text={quote('–ü—Ä–∏–≤—ñ—Ç! –•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è. –ö–æ–ª–∏ —É –≤–∞—Å —î –≤—ñ–ª—å–Ω–∏–π —á–∞—Å?')}"
    },
    "olya_wa": {
        "name": "–û–ª—è (WhatsApp)",
        "url": f"https://wa.me/380501234567?text={quote('–ü—Ä–∏–≤—ñ—Ç! –•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è.')}"
    },
    "sergiy_ig": {
        "name": "–°–µ—Ä–≥—ñ–π (Instagram)",
        "url": "https://instagram.com/sergiy_trainer"
    },
    "marina_tg": {
        "name": "–ú–∞—Ä–∏–Ω–∞ (Telegram)",
        "url": f"https://t.me/marina_fitness?text={quote('–ü—Ä–∏–≤—ñ—Ç! –¶—ñ–∫–∞–≤–ª—è—Ç—å –≥—Ä—É–ø–æ–≤—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è. –†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ —Ä–æ–∑–∫–ª–∞–¥.')}"
    },
    "volodymyr_wa": {
        "name": "–í–æ–ª–æ–¥–∏–º–∏—Ä (WhatsApp)",
        "url": f"https://wa.me/380679876543?text={quote('–î–æ–±—Ä–∏–π –¥–µ–Ω—å! –•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è.')}"
    }
}

def get_main_menu():
    """–°—Ç–≤–æ—Ä—é—î –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é"""
    builder = InlineKeyboardBuilder()
    builder.add(
        InlineKeyboardButton(text="üßë‚Äçüè´ –ó–∞–ø–∏—Å–∞—Ç–∏—Å—å –¥–æ —Ç—Ä–µ–Ω–µ—Ä–∞", callback_data="book_trainer"),
        InlineKeyboardButton(text="‚ÑπÔ∏è –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–æ QR-–∫–æ–¥–∏", callback_data="qr_info")
    )
    builder.adjust(1)
    return builder.as_markup()

def get_trainers_menu():
    """–°—Ç–≤–æ—Ä—é—î –º–µ–Ω—é –∑ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏"""
    builder = InlineKeyboardBuilder()
    
    for trainer_key, trainer_data in TRAINERS.items():
        builder.add(
            InlineKeyboardButton(
                text=trainer_data["name"], 
                url=trainer_data["url"]
            )
        )
    
    builder.add(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_main"))
    builder.adjust(2)  # –ü–æ 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥—É
    return builder.as_markup()

def get_machine_menu():
    """–°—Ç–≤–æ—Ä—é—î –º–µ–Ω—é –¥–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞"""
    builder = InlineKeyboardBuilder()
    builder.add(
        InlineKeyboardButton(text="üßë‚Äçüè´ –ó–∞–ø–∏—Å–∞—Ç–∏—Å—å –¥–æ —Ç—Ä–µ–Ω–µ—Ä–∞", callback_data="book_trainer"),
        InlineKeyboardButton(text="üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É", callback_data="back_to_main")
    )
    builder.adjust(1)
    return builder.as_markup()

def get_back_menu():
    """–°—Ç–≤–æ—Ä—é—î –º–µ–Ω—é –∑ –∫–Ω–æ–ø–∫–æ—é –Ω–∞–∑–∞–¥"""
    builder = InlineKeyboardBuilder()
    builder.add(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_main"))
    return builder.as_markup()

@router.message(CommandStart())
async def start_command(message: Message):
    """–û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é deep linking"""
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î payload (deep link –ø–∞—Ä–∞–º–µ—Ç—Ä)
    args = message.text.split()
    
    if len(args) > 1:
        # –Ñ payload - —Ü–µ deep link –∑ QR-–∫–æ–¥—É
        machine_code = args[1]
        
        if machine_code in MACHINES:
            # –ó–Ω–∞–π—à–ª–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä
            machine_data = MACHINES[machine_code]
            
            await message.answer(
                f"üèãÔ∏è‚Äç‚ôÇÔ∏è <b>–í—ñ–¥–º—ñ–Ω–Ω–æ! –í–∏ –æ–±—Ä–∞–ª–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä</b>\n\n"
                f"üìù <b>–û–ø–∏—Å:</b> {machine_data['desc']}\n\n"
                f"üé• <b>–í—ñ–¥–µ–æ-—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</b>\n{machine_data['video']}\n\n"
                f"üí™ <b>–ü–æ—Ä–∞–¥–∞:</b> –ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –∑—Ä–æ–±—ñ—Ç—å —Ä–æ–∑–º–∏–Ω–∫—É!\n\n"
                f"–ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞ —Ç—Ä–µ–Ω–µ—Ä–∞? –ó–∞–ø–∏—Å—É–π—Ç–µ—Å—å –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è! üëá",
                reply_markup=get_machine_menu(),
                parse_mode="HTML"
            )
        else:
            # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–æ–¥
            await message.answer(
                "‚ùå <b>–û–π, —Ç—Ä–µ–Ω–∞–∂–µ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</b>\n\n"
                "–°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Å–∫–∞–Ω—É–≤–∞—Ç–∏ QR-–∫–æ–¥ —â–µ —Ä–∞–∑ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ª—É.\n\n"
                "–ú–æ–∂–ª–∏–≤–æ, QR-–∫–æ–¥ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π –∞–±–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π.",
                reply_markup=get_main_menu(),
                parse_mode="HTML"
            )
    else:
        # –ó–≤–∏—á–∞–π–Ω–∏–π —Å—Ç–∞—Ä—Ç –±–µ–∑ payload
        await message.answer(
            "üèãÔ∏è‚Äç‚ôÇÔ∏è <b>–í—ñ—Ç–∞—î–º–æ —É –Ω–∞—à–æ–º—É —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–º—É –∑–∞–ª—ñ!</b>\n\n"
            "–Ø –≤–∞—à –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ —É –∑–∞–ª—ñ. ü§ñ\n\n"
            "<b>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:</b>\n"
            "üì± –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ—Å–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ, —ñ —è –º–∏—Ç—Ç—î–≤–æ –Ω–∞–¥—ñ—à–ª—é –≤—ñ–¥–µ–æ-—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é\n"
            "üé• –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è\n"
            "üßë‚Äçüè´ –ê–±–æ –∑–∞–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –Ω–∞—à–∏–º–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º–∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏\n\n"
            "–ì–æ—Ç–æ–≤—ñ –ø–æ—á–∞—Ç–∏? üí™",
            reply_markup=get_main_menu(),
            parse_mode="HTML"
        )

@router.callback_query(F.data == "book_trainer")
async def book_trainer_handler(callback: CallbackQuery):
    """–û–±—Ä–æ–±–Ω–∏–∫ –∑–∞–ø–∏—Å—É –¥–æ —Ç—Ä–µ–Ω–µ—Ä–∞"""
    await callback.message.edit_text(
        "üßë‚Äçüè´ <b>–ù–∞—à—ñ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ —Ç—Ä–µ–Ω–µ—Ä–∏</b>\n\n"
        "–û–±–µ—Ä—ñ—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞ —Ç–∞ –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∏–º –Ω–∞–ø—Ä—è–º—É –¥–ª—è –∑–∞–ø–∏—Å—É –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:\n\n"
        "üí¨ <b>Telegram</b> - –º–∏—Ç—Ç—î–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è\n"
        "üì± <b>WhatsApp</b> - –∑—Ä—É—á–Ω—ñ –¥–∑–≤—ñ–Ω–∫–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è\n"
        "üì∏ <b>Instagram</b> - –ø–æ–¥–∏–≤—ñ—Ç—å—Å—è —Ñ–æ—Ç–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å\n\n"
        "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —ñ–º'—è —Ç—Ä–µ–Ω–µ—Ä–∞, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ —á–∞—Ç:",
        reply_markup=get_trainers_menu(),
        parse_mode="HTML"
    )

@router.callback_query(F.data == "qr_info")
async def qr_info_handler(callback: CallbackQuery):
    """–û–±—Ä–æ–±–Ω–∏–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ QR-–∫–æ–¥–∏"""
    await callback.message.edit_text(
        "üì± <b>–Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è QR-–∫–æ–¥–∞–º–∏</b>\n\n"
        "1Ô∏è‚É£ –ó–Ω–∞–π–¥—ñ—Ç—å —á–æ—Ä–Ω–æ-–±—ñ–ª–∏–π –∫–≤–∞–¥—Ä–∞—Ç–Ω–∏–π –∫–æ–¥ –Ω–∞ —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ\n"
        "2Ô∏è‚É£ –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–∞–º–µ—Ä—É –≤–∞—à–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É\n"
        "3Ô∏è‚É£ –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥\n"
        "4Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —â–æ –∑'—è–≤–∏—Ç—å—Å—è\n"
        "5Ô∏è‚É£ –û—Ç—Ä–∏–º–∞–π—Ç–µ –º–∏—Ç—Ç—î–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é! üéØ\n\n"
        "üìç <b>–î–µ –∑–Ω–∞–π—Ç–∏ QR-–∫–æ–¥–∏:</b>\n"
        "‚Ä¢ –ù–∞ –∫–æ–∂–Ω–æ–º—É —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ\n"
        "‚Ä¢ –ë—ñ–ª—è –¥–∑–µ—Ä–∫–∞–ª —É –∑–∞–ª—ñ\n"
        "‚Ä¢ –ù–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö —Å—Ç–µ–Ω–¥–∞—Ö\n\n"
        "‚ùì <b>–ù–µ –ø—Ä–∞—Ü—é—î?</b> –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—è –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É.",
        reply_markup=get_back_menu(),
        parse_mode="HTML"
    )

@router.callback_query(F.data == "back_to_main")
async def back_to_main_handler(callback: CallbackQuery):
    """–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é"""
    await callback.message.edit_text(
        "üèãÔ∏è‚Äç‚ôÇÔ∏è <b>–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</b>\n\n"
        "–Ø –≤–∞—à –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ —É –∑–∞–ª—ñ. ü§ñ\n\n"
        "<b>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:</b>\n"
        "üì± –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ—Å–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ, —ñ —è –º–∏—Ç—Ç—î–≤–æ –Ω–∞–¥—ñ—à–ª—é –≤—ñ–¥–µ–æ-—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é\n"
        "üé• –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è\n"
        "üßë‚Äçüè´ –ê–±–æ –∑–∞–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –Ω–∞—à–∏–º–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º–∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏\n\n"
        "–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é:",
        reply_markup=get_main_menu(),
        parse_mode="HTML"
    )

@router.message(Command("help"))
async def help_command(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ø–æ–º–æ–≥–∏"""
    help_text = (
        "üÜò <b>–î–æ–≤—ñ–¥–∫–∞ –ø–æ –±–æ—Ç—É</b>\n\n"
        "üîç <b>–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:</b>\n"
        "‚Ä¢ –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è QR-–∫–æ–¥—ñ–≤ –Ω–∞ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞—Ö\n"
        "‚Ä¢ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–µ–æ-—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π\n"
        "‚Ä¢ –ó–∞–ø–∏—Å –¥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö —Ç—Ä–µ–Ω–µ—Ä—ñ–≤\n\n"
        "üìã <b>–ö–æ–º–∞–Ω–¥–∏:</b>\n"
        "/start - –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é\n"
        "/help - —Ü—è –¥–æ–≤—ñ–¥–∫–∞\n\n"
        "‚ùì <b>–ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞?</b>\n"
        "–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ª—É –∞–±–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –Ω–∞ —Ä–µ—Å–µ–ø—à–µ–Ω—ñ."
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_main_menu())

@router.message()
async def unknown_message_handler(message: Message):
    """–û–±—Ä–æ–±–∫–∞ –Ω–µ–≤—ñ–¥–æ–º–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å"""
    await message.answer(
        "ü§î <b>–ù–µ —Ä–æ–∑—É–º—ñ—é —Ü—é –∫–æ–º–∞–Ω–¥—É</b>\n\n"
        "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –Ω–∏–∂—á–µ –∞–±–æ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏.\n\n"
        "–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π –¥–æ —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ–≤ - —Å–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –Ω–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—ñ.",
        reply_markup=get_main_menu(),
        parse_mode="HTML"
    )

async def main():
    """–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞"""
    # –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Ä–æ—É—Ç–µ—Ä –¥–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
    dp.include_router(router)
    
    logger.info("üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    logger.info("üì± QR-–∫–æ–¥–∏ –º–∞—é—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∏–¥—É: https://t.me/YOUR_BOT_NAME?start=tre_001")
    
    try:
        # –í–∏–¥–∞–ª—è—î–º–æ webhook (—è–∫—â–æ –±—É–≤ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π)
        await bot.delete_webhook(drop_pending_updates=True)
        
        # –ó–∞–ø—É—Å–∫–∞—î–º–æ polling
        await dp.start_polling(bot)
    except Exception as e:
        logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞: {e}")
    finally:
        await bot.session.close()

if __name__ == "__main__":
    asyncio.run(main())
